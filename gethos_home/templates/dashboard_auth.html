{% load static %}

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Central</title>
    <link rel="stylesheet" href="{% static 'gethos_home/css/dashboard_auth.css' %}">

</head>


<body>
    {% comment %} INSERÇÃO DO MENU HEADER {% endcomment %}
    
    {% include 'menu_header.html' %}
    
    {% comment %} FIM DA INSERÇÃO DO MENU HEADER {% endcomment %}
      
      {% comment %} <div class="cards-container">
        <div class="card">
          <div class="card-content">
            <p class="card-title">Teste</p>
            <h3 class="card-amount">R$</h3>
            <p class="card-change positive">+10%</p>
            <span class="timeframe">7 Dias</span>
          </div>
        </div>
      
        <div class="card">
          <div class="card-content">
            <p class="card-title">Teste</p>
            <h3 class="card-amount">Teste</h3>
            <p class="card-change negative">-15%</p>
            <span class="timeframe">Cadastrado em 30/06/2024
            </span>
          </div>
        </div>
      
        <div class="card">
          <div class="card-content">
            <p class="card-title">Teste</p>
            <h3 class="card-amount">Teste</h3>
            <p class="card-change positive">+25%</p>
            <span class="timeframe">Teste</span>
          </div>
        </div>
      
        <div class="card">
          <div class="card-content">
            <p class="card-title">Teste</p>
            <h3 class="card-amount">$teste</h3>
            <p class="card-change positive">+30%</p>
            <span class="timeframe">teste 12 meses</span>
          </div>
        </div>
      </div> {% endcomment %}


      {% comment %} Início tabela de contatos {% endcomment %}
      <div class="container-div">
        <p class="list-contacts-title"><strong>LISTA DE CONTATOS</strong></p>
        <button class="adc-contato">Criar Novo Contato</button>
        <!-- Botão que mostrará o formulário de importação -->
        {% comment %} <button id="btn-importar" class="botao-importar" onclick="executarScraping()">Importar Contatos</button> {% endcomment %}
      </div>


<div class="table-container">

      

        <!-- The Modal -->
      <div id="myModal" class="modal">

          <!-- Modal content -->
        <div class="modal-content">
          <span class="close">&times;</span>
          <h2>Adicionar Novo Contato</h2>
          
          <!-- Formulário configurado corretamente -->
          <form method="POST" action="{% url 'dashboard_auth' %}">
              {% csrf_token %}  <!-- Adiciona proteção CSRF necessária no Django -->
              
              <label for="name">Nome Tutor</label>
              <input type="text" id="name" name="nome" placeholder="Olivia Silva" required>
              
              
              <label for="phone">Telefone</label>
              <input type="tel" id="phone" name="telefone" pattern="[0-9]{10,11}" title="Digite um número válido" required>
              
              
              <label for="nomeAnimal">Nome Pet</label>
              <input type="text" id="nome_animal" name="nome_animal" placeholder="Totó" required>


              <label for="veterinario">Veterinário Responsável</label>
              <select name="veterinario" required>
                  {% for vet in veterinarios %}
                      <option value="{{ vet.id }}">{{ vet.nome }}</option>
                  {% endfor %}
              </select>


              <label for="dataConsulta">Data do Atendimento</label>
              <input type="date" id="data_consulta" name="data_consulta" placeholder="12/12/2024" required>


              <label for="horaConsulta">Hora do Atendimento</label>
              <input type="time" id="hora_consulta" name="hora_consulta" placeholder="15:00" required>


              <label for="tipoAtendimento">Tipo do Atendimento</label>
              <input type="text" id="tipo_atendimento" name="tipo_atendimento" placeholder="Consulta Oftalmológica" required>

              <!-- Remova este campo -->
              {% comment %} <label for="dataAcao">Data do envio</label> {% endcomment %}
              {% comment %} <input type="date" id="dataAcao" name="dataAcao" placeholder="Consulta Oftalmológica" required> {% endcomment %}
              
              
              <label for="empresa">Empresa</label>
              <input type="text" id="empresa" name="empresa" placeholder="Empresa">
              
              <label for="status">Status</label>
              <select id="status" name="status" required>
                  <option value="Agendado">Agendado</option>
                  <option value="Confirmado">Confirmado</option>
                  <option value="Cancelado">Cancelado</option>
              </select>
              
              <button type="submit" class="create-btn">Criar</button>
          </form>
        </div>
      </div>



  <div class="page-wrapper">
    <div class="main-content">
     
      <!-- Tabela de Contatos -->
      <form method="POST" action="{% url 'dashboard_auth' %}">
          {% csrf_token %}
          <table class="contacts-table">
              <thead>
                  <tr>
                      <th><input type="checkbox" id="select-all"></th> <!-- Checkbox para selecionar todos -->
                      <th>ID</th>
                      <th>Nome</th>
                      <th>Telefone</th>
                      <th>Nome Pet</th>
                      <th>Veterinário Responsável</th>
                      <th>Data Atendimento</th>
                      <th>Hora Atendimento</th>
                      <th>Tipo do Atendimento</th>
                      <th>Data do Envio Mensagens</th>
                      <th>Empresa</th>
                      <th>Status</th>
                      <th>Criado em:</th>
                      <th>Ação</th>
                  </tr>
              </thead>
              <tbody>
                  {% for contato in listContacts %}
                  <tr>
                      <td><input type="checkbox" name="selected_contacts" value="{{ contato.id }}" class="contact-checkbox"></td> <!-- Checkbox individual -->
                      <td>{{ contato.id }}</td>
                      <td>{{ contato.nome }}</td>
                      <td>{{ contato.telefone_formatado }}</td>
                      <td>{{ contato.nome_animal }}</td>
                      <td>{{ contato.veterinario }}</td>
                      <td>{{ contato.data_consulta|date:"d/m/Y" }}</td>
                      <td>{{ contato.hora_consulta|time:"H:i" }}</td>
                      <td>{{ contato.tipo_atendimento }}</td>
                      <td>{{ contato.dataAcao|date:"d/m/Y" }}</td>
                      <td>{{ contato.empresa }}</td>
                      <td>{{ contato.status }}</td>
                      <td>{{ contato.data_criacao|date:"d/m/Y H:i"}}</td>
                      <td>
                        <div class="btn-grupo">
                          {% comment %} <button href="#" class="action-btn view-btn" id="btn-acion">Ver</button>
                          <button href="#" class="action-btn edit-btn" id="btn-acion">Editar</button>
                          <button href="#" class="action-btn delete-btn" id="btn-acion">Excluir</button> {% endcomment %}
                        </div>
                      </td>
                  </tr>
                  {% endfor %}
              </tbody>
          </table>

      
      
      
        </form>
       <!-- Sidebar retrátil -->
       <div id="sidebox" class="sidebox">
        <h3>Ações para Contatos Selecionados</h3>
        <p id="selected-count">Nenhum contato selecionado</p> <!-- Exibe a quantidade de contatos selecionados -->
        <button class="sidebox-btn">Enviar Whatsapp</button>
        <button class="sidebox-btn">Excluir</button>
        <button class="sidebox-btn">Exportar Contatos</button>
      </div>

    
</div>


</body>
<script>

var modal = document.getElementById("myModal");

// Seleciona o botão que abre o modal
var btn = document.querySelector(".adc-contato");

// Seleciona o <span> que fecha o modal
var span = document.getElementsByClassName("close")[0];

// Quando o botão é clicado, abre o modal
btn.onclick = function() {
  modal.style.display = "flex";
}

// Quando o <span> é clicado, fecha o modal
span.onclick = function() {
  modal.style.display = "none";
}

// Quando o usuário clica fora do modal, ele fecha
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}



{% comment %} script para realizar ação com os contatos selecionados. {% endcomment %}

// Script para selecionar ou desmarcar todos os checkboxes
document.getElementById('select-all').addEventListener('click', function(event) {
  let checkboxes = document.querySelectorAll('input[name="selected_contacts"]');
  checkboxes.forEach(checkbox => checkbox.checked = event.target.checked);
  toggleSidebox(); // Chama a função para verificar se a sidebar deve aparecer
});

// Script para monitorar a seleção dos checkboxes individuais
const contactCheckboxes = document.querySelectorAll('.contact-checkbox');
contactCheckboxes.forEach(checkbox => {
  checkbox.addEventListener('change', toggleSidebox);
});

// Função que exibe ou esconde a sidebar com base na seleção de checkboxes
function toggleSidebox() {
  let selectedCount = Array.from(contactCheckboxes).filter(checkbox => checkbox.checked).length;
  let sidebox = document.getElementById('sidebox');
  let selectedCountElement = document.getElementById('selected-count');
  
  if (selectedCount > 0) {
    sidebox.style.display = "block"; // Faz o sidebox aparecer
    setTimeout(() => {
        sidebox.classList.add('sidebox-active'); // Aplica a transição após exibir
    }, 10); // Pequeno atraso para permitir que a transição seja aplicada

      // Atualiza o texto da quantidade de contatos selecionados
      if (selectedCount === 1) {
          selectedCountElement.textContent = "1 contato selecionado";
      } else if (selectedCount === contactCheckboxes.length) {
          selectedCountElement.textContent = "Todos os contatos selecionados";
      } else {
          selectedCountElement.textContent = `${selectedCount} contatos selecionados`;
      }
  } else {
     // Oculta o sidebox com a transição
     sidebox.classList.remove('sidebox-active');
     setTimeout(() => {
         sidebox.style.display = "none"; // Esconde o sidebox após a transição
     }, 300); // Aguarda a transição (0.3s) antes de esconder
    selectedCountElement.textContent = "Nenhum contato selecionado";
  }
}

document.getElementById('btn-importar').addEventListener('click', function() {
  var form = document.getElementById('form-importar');
  // Alterna entre exibir e ocultar o formulário
  if (form.style.display === 'none') {
      form.style.display = 'block';
  } else {
      form.style.display = 'none';
  }
});


function executarScraping() {
  fetch("/importar-contatos/", {
      method: "POST",
      headers: {
          "X-CSRFToken": "{{ csrf_token }}" // Adiciona o CSRF Token para proteger a requisição
      }
  })
  .then(response => response.json())
  .then(data => {
      if (data.status === "sucesso") {
          alert(data.mensagem); // Mostra mensagem de sucesso
          console.log(data.dados); // Exibe os dados no console
      } else {
          alert(data.mensagem); // Mostra mensagem de erro
      }
  })
  .catch(error => {
      console.error("Erro ao importar contatos:", error);
      alert("Erro ao importar contatos. Verifique o console para mais detalhes.");
  });
}




</script>
</html>

